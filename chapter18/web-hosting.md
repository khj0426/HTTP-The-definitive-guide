# 18. HTTP 완벽 가이드 18장 - 웹 호스팅

# Intro. 무엇에 관한 챕터일까?

- 여러 웹 사이트를 같은 서버에 ‘가상 호스팅’
- 트래픽이 많은 상황에서 안정적인 사이트 구축 방법
- 웹 사이트 로딩을 빠르게 하는 방법

<br /><br /><br />

---

# 호스팅 서비스

## 호스팅이 무엇인가?

**콘텐츠 리소스를 저장, 중개, 관리하는 일**을 통틀어 호스팅이라 한다.

→ 다양한 리소스를 웹 사이트에 편하게 배포하거나 적절한 가격의 좋은 성능을 가진 웹 서버에 배치하는 것

<br />

### 1. 전용 호스팅

![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-03-07_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11 49 54](https://github.com/musinsa-global-developer-study/HTTP-The-definitive-guide/assets/72294509/3aa71ba8-b8a6-430a-80b9-be3a0a488e9a)

- ISP가 사용자의 서비스에 적절한 고성능 웹 서버 제공 (대여)
- 주로 대용량 서비스에 사용

<br />

### 2. 가상 호스팅

![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-03-07_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11 50 13](https://github.com/musinsa-global-developer-study/HTTP-The-definitive-guide/assets/72294509/2add3520-434f-4b88-bfaf-59f3380dd880)

- 컴퓨터 한 대를 여러 고객이 공유하게 하여 저렴한 웹 호스팅 서비스를 제공
- 주로 트래픽이 높지 않은 사이트에서 비용 절감을 위해 사용
- 호스팅 업자는 복제 서버더미(=서버 팜)을 생성하고 서버 팜에 부하를 분산한다. 팜에 있는 각 서버는 다른 서버를 복제한 것 <br />(20장에서 자세히 다룬다)

> 서버팜 : 서로 대신할 수 있고 식별할 수 있게 설정된 웹 서버들의 집합

<br /><br />

## 2.1 호스트 정보가 없는 가상 서버 요청 (HTTP/1.0)

- 에는 공용 웹 서버가 호스팅하고 있는 가상 웹 사이트에 누가 접근하고 있는지 식별하는 기능을 제공하지 않는 결함이 존재
- 각 다른 사이트의 `index.html`에 접근하려 해도, 똑같이 `GET /index.html`의 요청을 보낸다.

<br /><br />

## 2.2 가상 호스팅 동작하게 하기 (HTTP/1.1)

### URL 경로를 통한 가상 호스팅
  1. 서버가 어떤 사이트를 요청하는 것인지 알 수 있게 URL에 특정 경로를 붙인다. 
  2. 불필요한 접두어가 생겨 나쁜 방법 (`GET /jiyoung/index.html`)

### 포트번호를 통한 가상 호스팅
  1. 각 사이트에 다른 포트번호 할당, 분리된 웹 서버의 인스턴스가 요청을 처리하게 한다.
  2. 비표준 프로토콜을 붙여야 하기 때문에 나쁜 방법


### IP 주소를 통한 가상 호스팅 ⭐️
   
  ![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-03-07_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12 02 27](https://github.com/musinsa-global-developer-study/HTTP-The-definitive-guide/assets/72294509/e9416a6f-11db-44cb-9856-df433fe54135)
    
  1. 각 가상 사이트에 별도의 IP 주소를 할당하고, 모든 IP 주소를 장비 하나에 연결
  2. 서버가 목적지 IP 주소를 보고 어떤 클라이언트가 어떤 웹 사이트에 연결하려 하는지 알 수 있다.
  3. IP 주소 부족 문제가 생길 수 있지만 널리 사용 되는 방법

### Host 헤더를 통한 가상 호스팅 ⭐️⭐️

  ![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-03-07_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12 02 49](https://github.com/musinsa-global-developer-study/HTTP-The-definitive-guide/assets/72294509/03cfae2c-2538-46b7-97e5-99fdd77d756d)
    
  1. Host 확장 헤더에 호스트명을 기술해서 전달할 수 있도록 HTTP를 확장
  2. 서버가 원활하게 원 호스트명을 받아볼 수 있다. 
    
<br /><br />

## 2.3 Host 헤더

### 문법과 사용 방법

```
Host = "Host" ":" 호스트[":"포트]
```

<br />

### 규칙

- 포트가 없을 시, 해당 스킴의 기본 포트 사용
- URL에 IP주소가 있다면, Host 헤더는 같은 주소를 포함해야 함
- URL에 호스트 명이 기술되어 있다면, Host 헤더는 같은 호스트 명을 포함해야 함
    - URL의 호스트 명이 가리키는 IP 주소를 포함해서는 안된다. (가상 호스트 서버에서 문제)
- 클라이언트가 특정 프락시 서버를 사용한다면, Host 헤더에 ‘원 서버’의 호스트 명과 포트를 기술해야 한다.
- 웹 클라이언트는 모든 요청 메세지에 Host 헤더를 기술해야 한다.
- 웹 프락시는 요청을 전달하기 전에 요청 메세지에 Host 헤더를 추가해야 한다.
- Host 헤더 필드가 없는 요청 메세지를 받으면 `400 Bad Request code`로 답해야 한다. <br />(HTTP 1.1 웹 서버 기준)

```
GET http://www.joes-hardware.com/index.html
Connection: Keep-Alive
User-Agent: Mozilla/4.51 [en] 
Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */*
Accept-Encoding: gzip
Accept-Language: en
Host: www.joes-hardware.com
```

<br />

### 관련 상황

- Host 헤더의 누락
    - 아직 사용되고 있는 몇몇 낡은 브라우저들은 Host 헤더를 보내지 않는다.
    - 에러 메세지를 반환한다
- Host 헤더 해석하기
    - 모든 웹 서버는 `HTTP/1.1`을 통해 오는 리소스를 결정하려면 다음과 같은 규칙을 사용해야 한다
        1. HTTP 요청 메시지에 전체 URL이 기술되어 있으면, Host 헤더에 있는 값은 무시하고 URL을 사용한다
        2. HTTP 요청 메시지에 있는 URL 에 호스트 명이 기술되어 있지 않고 요청에 Host헤더가 있으면, 호스트 명과 포트를 Host 헤더에서 가져온다.
        3. 1단계나 2단계에서 호스트를 결정할 수 없으면 클라이언트에 400 Bad Request 응답을 반환한다.
    - 물론 요즘의 거의 모든 브라우저는 Host 헤더를 전송한다.
- HTTP 헤더와 프락시
    - 프락시를 사용하도록 구성할 때 버전이 오래된 애플이나 포인트캐스트 클라이언트는 <br />실수로 원 서버의 이름이 아닌 프락시의 이름을 Host 헤더에 담아 전송한다.
    

<br /><br /><br />

# 3. 안정적인 웹 사이트 만들기

웹 사이트는 다음과 같을 때 장애가 생긴다

- 서버 다운
- 트래픽 폭증
- 네트워크 장애나 손실

이런 일반적인 문제를 예측하고 대응하는 몇 가지 방법이 필요하다.

<br /><br />

## 3.1 미러링 된 서버 팜

서버팜의 서버에 있는 콘텐츠들은 미러링되어 있다. 

> 서버팜 : 서로 대신할 수 있고 식별할 수 있게 설정된 웹 서버들의 집합

<br />

이러한 서버 팜에 배포하는 간단한 방법 중 하나는 네트워크 스위치 사용네트워크 스위치로 서버에 분산 요청을 보내는 것이다. <br />(서버에 호스팅 되고 있는 각 웹사이트의 IP 주소 = 스위치 IP 주소가 된다.)

- **마스터 원 서버** : 콘텐츠의 원본 제작자처럼 행동
- **복제 원 서버**: 마스터 원 서버로부터 미러링 된 서버
  
![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-03-07_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12 21 55](https://github.com/musinsa-global-developer-study/HTTP-The-definitive-guide/assets/72294509/252990d7-d5fb-43c5-81c8-71a6f738acc0)

미러링된 서버들의 계층 관계로 한 곳에 문제가 생기면 다른 한곳에 대신 전달할 수 있다.

<br />

![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-03-07_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12 22 23](https://github.com/musinsa-global-developer-study/HTTP-The-definitive-guide/assets/72294509/e5612821-5eb4-44b8-9305-b078883c96fa)


### 분산된 미러링 서버에서 요청이 특정 서버로 가는 방법

- HTTP 리다이렉션
    - 콘텐츠에 대한 URL은 마스터 서버의 IP를 가리킨다
    - 마스터 서버가 복제 서버로 리다이렉트시킨다.
- DNS 리다이렉션
    - DNS 서버가 클라이언트에게 전송할 IP 주소 선택

<br /><br />

## 3.2 콘텐츠 분산 네트워크 (CDN)

콘텐츠 분산 네트워크는 특정 콘텐츠의 분산을 목적으로 하는 단순한 네트워크이다.

네트워크의 노드는 서버, 대리 서버, 프락시 서버가 될 수 있다.

<br />

### CDN의 대리 캐시

대리 캐시(= 리버스 캐시)는 복제 원서버를 대신해서 사용될 수 있다.

- 미러링 된 웹 서버처럼 콘텐츠에 대한 요청을 받는다.
- 보통 수요에 따라 동작한다
    - 미러링 된 서버: 원 서버의 전체 콘텐츠를 복사
    - 대리 서버: 클라이언트가 요청하는 콘텐츠만 저장

<br />

### CDN의 프락시 캐시

대리 서버와는 다르게, 전통적인 프락시 서버는 어떠한 웹 서버 요청을 전부 받을 수 있다. 

- 원 서버 간의 연동이나 IP 주소 합의가 필요하지 않다.

하지만 대리서버 이용하여 요청이 있을 때만 저장하는 프락시 캐시 방식을 사용할 수 있다.

- 프락시 캐시의 콘텐츠는 요청이 있을 때만 저장된다.
- 대리 캐시와 유사하지만, 미러링 된 웹 서버를 대체하는 대리 캐시와는 다른 레이어에서 작동한다.

![%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-03-07_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12 34 00](https://github.com/musinsa-global-developer-study/HTTP-The-definitive-guide/assets/72294509/eb245f25-93f2-457f-8784-054a7af27dca)

- 레이어 2, 레이어 3 장비 (스위치나 라우터)가 중간에서 웹 트래픽을 가로채 처리하는 방식을 택하곤 한다.
- 이런 가로채기 설정은, 클라이언트와 서버 사이의 모든 HTTP 요청이 물리적으로 캐시를 거치게 네트워크 설정을 할 수 있는지에 대한 여부에 따라 달라진다. (20장 참고)

<br /><br /><br />

# 4. 빠른 웹 사이트 만들기

서버팜, 분산 프락시 캐시, 대리서버는 혼잡을 조절하고 네트워크 트래픽을 분산시킨다.

콘텐츠를 분산시키면 콘텐츠의 위치가 사용자와 더 가까워지므로 콘텐츠를 서버에서 클라이언트로 전송하는 시간이 단축된다.

웹 사이트 속도를 높이는 또다른 방법은 콘텐츠를 인코딩 하는 것이다. (콘텐츠 압축, 15장에서 했었죠!)

<br /><br /><br />

---

# 요약

- **웹 호스팅** : 콘텐츠 리소스를 저장, 중개, 관리하는 일을 통틀어 말한다.
    - 전용 호스팅
    - 가상 호스팅
- **가상 호스팅을 동작하게 하기 위해서는?**
    - **URL 경로를 통한 가상 호스팅**
    - **포트번호를 통한 가상 호스팅**
    - **IP 주소를 통한 가상 호스팅 ⭐️ → 주로 사용**
    - **Host 헤더를 통한 가상 호스팅 ⭐️⭐️ → 주로 사용**
- **안정적인 웹 사이트를 만들기 위해서는?**
    - 미러링 된 서버 팜
    - 콘텐츠 분산 네트워크 (CDN)
        - 대리 캐시 방식 (원서버 대체)
        - 프락시 캐시 방식 (스위치나 라우터에서 정보 가로채기)
- 💡 **결론: 빠른 웹 사이트를 구축하기 위해서는?**
    - 위의 서버 팜, 분산 프락시 캐시, 대리서버를 사용하여 서버 - 클라이언트 간 데이터 전송 시간을 단축
    - 또 다른 방법으로는 콘텐츠 인코딩!
